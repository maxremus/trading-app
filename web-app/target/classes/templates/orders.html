<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="bg">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ—Ä—ä—á–∫–∏ | TradingApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 1rem; }
        .order-items { font-size: 0.9rem; color: #555; }
        .order-items li { margin-bottom: 2px; }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="card shadow-sm p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="m-0">üì¶ –°–ø–∏—Å—ä–∫ —Å –ø–æ—Ä—ä—á–∫–∏</h3>
            <a th:href="@{/orders/add}" class="btn btn-success">‚ûï –ù–æ–≤–∞ –ø–æ—Ä—ä—á–∫–∞</a>
        </div>

        <table class="table table-striped align-middle">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>–ö–ª–∏–µ–Ω—Ç</th>
                <th>–î–∞—Ç–∞</th>
                <th>–ü—Ä–æ–¥—É–∫—Ç–∏</th>
                <th>–û–±—â–∞ —Å—É–º–∞</th>
                <th>–§–∞–∫—Ç—É—Ä–∞ (PDF)</th>
                <th class="text-center">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="o, iterStat : ${orders}">
                <td th:text="${iterStat.index + 1}"></td>
                <td th:text="${o.customer.name}"></td>
                <td th:text="${#temporals.format(o.createdOn, 'dd.MM.yyyy HH:mm')}"></td>
                <td>
                    <ul class="list-unstyled order-items mb-0">
                        <li th:each="item : ${o.items}">
                            <span th:text="${item.product.name}"></span>
                            (<span th:text="${item.quantity}"></span> –±—Ä.) √ó
                            <span th:text="${#numbers.formatDecimal(item.price, 1, 2)}"></span> –ª–≤ =
                            <strong th:text="${#numbers.formatDecimal(item.total, 1, 2)}"></strong> –ª–≤
                        </li>
                    </ul>
                </td>
                <td><strong th:text="${#numbers.formatDecimal(o.totalPrice, 1, 2)} + ' –ª–≤'"></strong></td>

                <td class="text-center">
                    <a th:if="${o.invoiceId != null}"
                       th:href="@{'http://localhost:8081/api/v1/invoices/' + ${o.invoiceId} + '/pdf'}"
                       class="btn btn-outline-success btn-sm" target="_blank">
                        ‚¨áÔ∏è –ò–∑—Ç–µ–≥–ª–∏ —Ñ–∞–∫—Ç—É—Ä–∞
                    </a>
                    <span th:if="${o.invoiceId == null}" class="text-muted">‚Äî</span>
                </td>

                <td class="text-center">
                    <a th:href="@{'/orders/edit/' + ${o.id}}" class="btn btn-outline-warning btn-sm">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</a>

                    <form th:action="@{'/orders/delete/' + ${o.id}}" method="post" style="display:inline;">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                        <button type="submit" class="btn btn-outline-danger btn-sm"
                                onclick="return confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–∞–∑–∏ –ø–æ—Ä—ä—á–∫–∞?')">
                            üóë –ò–∑—Ç—Ä–∏–π
                        </button>
                    </form>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(orders)}">
                <td colspan="7" class="text-center text-muted">–ù—è–º–∞ —Å—ä–∑–¥–∞–¥–µ–Ω–∏ –ø–æ—Ä—ä—á–∫–∏.</td>
            </tr>
            </tbody>
        </table>

        <div class="mt-3 text-center">
            <a th:href="@{/dashboard}" class="text-decoration-none">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º —Ç–∞–±–ª–æ—Ç–æ</a>
        </div>
    </div>
</div>
</body>
</html>
